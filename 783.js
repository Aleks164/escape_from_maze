(()=>{"use strict";var r;function t(r){var t=Math.ceil(Math.random()*r);return t%2==0&&t++,0===t&&t++,t>=r&&(t=r-2),t}function e(r,t){(null==t||t>r.length)&&(t=r.length);for(var e=0,n=new Array(t);e<t;e++)n[e]=r[e];return n}function n(r,t){return function(r){if(Array.isArray(r))return r}(r)||function(r,t){var e=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=e){var n,a,o=[],c=!0,i=!1;try{for(e=e.call(r);!(c=(n=e.next()).done)&&(o.push(n.value),!t||o.length!==t);c=!0);}catch(r){i=!0,a=r}finally{try{c||null==e.return||e.return()}finally{if(i)throw a}}return o}}(r,t)||function(r,t){if(r){if("string"==typeof r)return e(r,t);var n=Object.prototype.toString.call(r).slice(8,-1);return"Object"===n&&r.constructor&&(n=r.constructor.name),"Map"===n||"Set"===n?Array.from(r):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(r,t):void 0}}(r,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(r,t,e){var a=n(t,2),o=a[0],c=a[1];return t[0]>e[0]&&r[o-1]&&(r[o-1][c]=" "),t[0]<e[0]&&r[o+1]&&(r[o+1][c]=" "),t[1]>e[1]&&r[o][c-1]&&(r[o][c-1]=" "),t[1]<e[1]&&r[o][c+1]&&(r[o][c+1]=" "),r}function o(r,t){var e=n(t,2),a=e[0],o=e[1],c=[];return r[a+2]&&" "===r[a+2][o]&&a+2!==r.length-1&&a+2!==0&&c.push([a+2,o]),r[a-2]&&" "===r[a-2][o]&&a-2!=r.length-1&&a-2!=0&&c.push([a-2,o]),r[a][o+2]&&" "===r[a][o+2]&&o+2!==r[a].length-1&&o+2!==0&&c.push([a,o+2]),r[a][o-2]&&" "===r[a][o-2]&&o-2!=r[a].length-1&&o-2!=0&&c.push([a,o-2]),c}function c(r){switch(r){case"#":return"wall";case"*":return"shortWayColor";case">":case"<":case"v":case"^":return"steps";case"horizontal":return"horizontal";case"vertical":return"vertical";default:return"empty"}}function i(r,t,e){return t in r?Object.defineProperty(r,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):r[t]=e,r}function s(r,t,e,n){var a=n[r].split("");a[t]=e,n[r]=a.join("")}function u(r,t){var e=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),e.push.apply(e,n)}return e}function l(r){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?u(Object(e),!0).forEach((function(t){i(r,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(e)):u(Object(e)).forEach((function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(e,t))}))}return r}function p(r,t){var e=t.startPosition,a=t.startDirection,o=t.coordList,c=t.currentWay,u=t.listOfCrosses,p=t.prev,f=t.isEscaped,h=t.crossingsParamArray;if(f)return t;var v,g,y,d,m,O=function(r,t,e,a){var o=function(r,t,e){var n=[];return e[r+1]&&" "===e[r+1][t]&&(n.push([r+1,t]),s(r+1,t,"v",e)),e[r-1]&&" "===e[r-1][t]&&(n.push([r-1,t]),s(r-1,t,"^",e))," "===e[r][t+1]&&(n.push([r,t+1]),s(r,t+1,">",e))," "===e[r][t-1]&&(n.push([r,t-1]),s(r,t-1,"<",e)),n}(e,a,r);if(!o.length)return{nextStep:[],nextDirection:"",resultLOg:[]};var c,i,u,l,p,f=n(o[0],2),h=(c=[e,a],i=[f[0],f[1]],l=[],p=">",c[0]>i[0]&&(p="^"),c[0]<i[0]&&(p="v"),c[1]>i[1]&&(p="<"),c[1]<i[1]&&(p=">"),(u=t)===p?l.push("F"):">"===u?("<"===p&&l.push("B","F"),"^"===p&&l.push("L","F"),"v"===p&&l.push("R","F")):"<"===u?(">"===p&&l.push("B","F"),"v"===p&&l.push("L","F"),"^"===p&&l.push("R","F")):"v"===u?("^"===p&&l.push("B","F"),"<"===p&&l.push("R","F"),">"===p&&l.push("L","F")):"^"===u&&("v"===p&&l.push("B","F"),">"===p&&l.push("R","F"),"<"===p&&l.push("L","F")),{nextDirection:p,resultLOg:l});return{nextStep:o,nextDirection:h.nextDirection,resultLOg:h.resultLOg}}(r,a,e[0],e[1]),b=O.nextStep,w=O.nextDirection,j=O.resultLOg;if(e[1]===r[0].length-1||e[0]===r.length-1||0===e[0]||0===e[1])return c=c.concat(j),o.push([e[0],e[1]]),h.push(i({},e.toString(),{way:c,from:p,coord:o})),f=!0,l(l({},t),{},{coordList:o,currentWay:c,crossingsParamArray:h,isEscaped:f});if(b.length>1&&"string"!=typeof b){o.push([e[0],e[1]]);var P=b.splice(1,b.length-1);u=u.concat(P),h.push(i({},e.toString(),{way:c,from:p,coord:o})),c=[],o=[],p=e.toString()}if(c=c.concat(j),b.length)o.push([e[0],e[1]]),e=n(b,1)[0],a=w;else{var A=u.shift();o=[],A&&(e=A,p=(v=a=r[A[0]][A[1]],g=e,y=[],d=g[1],m=g[0],">"===v&&(y=y.concat([m,d-1])),"<"===v&&(y=y.concat([m,d+1])),"^"===v&&(y=y.concat([m+1,d])),"v"===v&&(y=y.concat([m-1,d])),y).toString()),c=[a]}return{startPosition:e,startDirection:a,coordList:o,currentWay:c,listOfCrosses:u,crossingsParamArray:h,prev:p,isEscaped:f}}function f(r,t){var e=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),e.push.apply(e,n)}return e}function h(r){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?f(Object(e),!0).forEach((function(t){i(r,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(e)):f(Object(e)).forEach((function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(e,t))}))}return r}!function(r){r.DRAW_ESCAPING="drawEscaping",r.DRAW_NEW_MAZE="drawNewMaze"}(r||(r={}));var v={};self.onmessage=function(e){var n,i,s,u,l=e.data,f=l.mazeParams,g=l.key,y=l.type;switch(y){case r.DRAW_NEW_MAZE:var d=(n=f.height,i=f.width,u=function(r){for(var e,n,c=[1,1],i=c,s=[c];s.length;){r[i[0]][i[1]]="*";var u=o(r,i);if(0!==u.length){u.length>1&&s.push(i);var l=(n=(e=u).length,e[Math.floor(Math.random()*n)]);a(r,i,l),i=l}else i=s.shift()}return r[t(r.length)][1]=">",r.map((function(r){return r.join("").replaceAll("*"," ")}))}(function(r,e){var n=2*r+1,a=2*e+1,o=Array(a).fill(""),c=t(a);return o.map((function(r,t,e){return 0===t||t===e.length-1||t%2==0?Array(n).fill("#"):Array(n).fill(" ").map((function(r,e,a){return t===c&&e===n-1?" ":e%2==0||0===e||e===a.length-1?"#":"".concat(r)}))}))}(n,i)),{newMaze:self.structuredClone(u),mazeMarkup:(s=u,'<div class="mazeRow"><div class="mazeRow" style="grid-template-columns: repeat('.concat(s[0].length+1,',15px); ">\n  ').concat(Array(s[0].length).fill(0).map((function(r,t){var e="";return 0===t&&(e="<div> </div>"),"".concat(e,"<div  class=").concat(c("vertical"),">").concat(t+1,"</div>")})).join(""),"</div>\n  ").concat(s.map((function(r,t){return'<div class="mazeRow" style="grid-template-columns: repeat('.concat(s[0].length+1,',15px); ">').concat(r.split("").map((function(r,e){var n="";return 0===e&&(n="<div class=".concat(c("horizontal"),">").concat(t+1,"</div>")),"".concat(n,"<div class=").concat(c(r),">").concat(r||".","</div>")})).join(""),"</div>")})).join(""),"</div>"))}),m=d.mazeMarkup,O=d.newMaze;v[g]=O,self.postMessage({mazeMarkup:m,type:y});break;case r.DRAW_ESCAPING:var b=v[g],w=function(r){for(var t=function(r){for(var t=["<","^",">","v"],e=[0,0],n="",a=0;a<r.length;a++)for(var o=0;o<r[a].length;o++){if(t.indexOf(r[a][o])>=0){e=[a,o],n=r[a][o];break}if(n)break}return{startPosition:e,startDirection:n}}(r),e=h(h(h({},t),{coordList:[],currentWay:[],listOfCrosses:[],crossingsParamArray:[{start:{way:[],from:null,coord:[]}}],prev:"start"}),{},{isEscaped:!1});!e.isEscaped;)e=p(r,e);return e.crossingsParamArray}(b);self.postMessage({crossingsParamArray:w,newMaze:b,type:y})}}})();